# Enable PSRAM support
# CONFIG_SPIRAM=y

# PSRAM Mode - Choose one:
# CONFIG_SPIRAM_MODE_OCT=y
# CONFIG_SPIRAM_MODE_QUAD=n

# PSRAM Speed
# CONFIG_SPIRAM_SPEED_80M=y
# CONFIG_SPIRAM_SPEED_40M=n

# PSRAM Type - ESP32-S3 auto-detects, but you can specify:
# CONFIG_SPIRAM_TYPE_AUTO=y
# CONFIG_SPIRAM_TYPE_ESPPSRAM64=y

# Memory allocation strategy - Choose one: CONFIG_SPIRAM_USE_MALLOC=y
# CONFIG_SPIRAM_USE_CAPS_ALLOC=y  (recommended for explicit control)
# CONFIG_SPIRAM_USE_MEMMAP=n

# Malloc behavior with PSRAM
# CONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=16384
# CONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=32768

# Enable PSRAM workaround for cache issues
# CONFIG_SPIRAM_CACHE_WORKAROUND=y

# PSRAM memory test on startup CONFIG_SPIRAM_MEMTEST=y

# Allow .bss segment in PSRAM CONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY=y

# Stack in PSRAM (optional - be careful with ISRs)
# CONFIG_SPIRAM_ALLOW_STACK_EXTERNAL_MEMORY=n

# PSRAM size (auto-detected usually)
# CONFIG_SPIRAM_SIZE=8388608  # 8MB


# Core PSRAM Settings
CONFIG_SPIRAM=y
CONFIG_SPIRAM_MODE_OCT=y
CONFIG_SPIRAM_SPEED_80M=y
CONFIG_SPIRAM_TYPE_ESPPSRAM64=y

# Use capabilities allocator (gives you control via heap_caps_malloc)
CONFIG_SPIRAM_USE_CAPS_ALLOC=y

# Reserve internal RAM for critical operations
CONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=16384
CONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=32768

# Enable workarounds and testing
CONFIG_SPIRAM_CACHE_WORKAROUND=y
CONFIG_SPIRAM_MEMTEST=y

# Allow BSS in external memory
CONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY=y

# PSRAM MMU integration
CONFIG_SPIRAM_FETCH_INSTRUCTIONS=n
CONFIG_SPIRAM_RODATA=n

# Memory region organization
CONFIG_ESP32S3_INSTRUCTION_CACHE_SIZE=16384
CONFIG_ESP32S3_DATA_CACHE_SIZE=32768

# Cache line size
CONFIG_ESP32S3_INSTRUCTION_CACHE_LINE_32B=y
CONFIG_ESP32S3_DATA_CACHE_LINE_32B=y

# PSRAM Clock source
CONFIG_SPIRAM_CLK_IO=30
CONFIG_SPIRAM_CS_IO=26